// Module included in the following assemblies:
//
// * updating/updating-cluster-cli.adoc
// * updating/updating-cluster-rhel-compute.adoc

:_content-type: PROCEDURE
[id="update-upgrading-cli_{context}"]
= Updating a cluster by using the CLI

If updates are available, you can update your cluster by using the
OpenShift CLI (`oc`).

You can find information about available {product-title} advisories and updates
link:https://access.redhat.com/downloads/content/290[in the errata section]
of the Customer Portal.

.Prerequisites

* Install the OpenShift CLI (`oc`) that matches the version for your updated version.
* Log in to the cluster as user with `cluster-admin` privileges.

* Pause all `MachineHealthCheck` resources.

.Procedure

. Ensure that your cluster is available:
+
[source,terminal]
----
$ oc get clusterversion
----
+
.Example output
[source,terminal]
----
NAME      VERSION   AVAILABLE   PROGRESSING   SINCE   STATUS
version   4.8.13     True        False         158m    Cluster version is 4.8.13
----

. Review the current update channel information and confirm that your channel
is set to `stable-4.9`:
+
[source,terminal]
----
$ oc get clusterversion -o json|jq ".items[0].spec"
----
+
.Example output
[source,terminal]
----
{
  "channel": "stable-4.9",
  "clusterID": "990f7ab8-109b-4c95-8480-2bd1deec55ff"
}
----
+
[IMPORTANT]
====
For production clusters, you must subscribe to a `stable-\*` or `fast-*` channel.
====

. View the available updates and note the version number of the update that
you want to apply:
+
[source,terminal]
----
$ oc adm upgrade
----
+
.Example output
[source,terminal,subs="attributes+"]
----
Cluster version is 4.8.13

Updates:

VERSION IMAGE
4.9.0   quay.io/openshift-release-dev/ocp-release@sha256:9c5f0df8b192a0d7b46cd5f6a4da2289c155fd5302dec7954f8f06c878160b8b
----

. Apply an update:
** To update to the latest version:
+
[source,terminal]
----
$ oc adm upgrade --to-latest=true <1>
----

** To update to a specific version:
+
[source,terminal]
----
$ oc adm upgrade --to=<version> <1>
----
<1> `<version>` is the update version that you obtained from the output of the
previous command.

. Review the status of the Cluster Version Operator:
+
[source,terminal]
----
$ oc adm upgrade
----

. After the update completes, you can confirm that the cluster version has
updated to the new version:
+
[source,terminal]
----
$ oc adm upgrade
----
+
.Example output
[source,terminal]
----
Cluster version is <version>
Upstream is unset, so the cluster will use an appropriate default.
Channel: stable-{product-version} (available channels: candidate-{product-version}, fast-{product-version}, stable-{product-version})
No updates available. You may force an upgrade to a specific release image, but doing so may not be supported and may result in downtime or data loss.
----

. If you are upgrading your cluster to the next minor version, like version X.y to X.(y+1), it is recommended to confirm your nodes are upgraded before deploying workloads that rely on a new feature:
+
[source,terminal]
----
$ oc get nodes
----
+
.Example output
[source,terminal]
----
NAME                           STATUS   ROLES    AGE   VERSION
ip-10-0-168-251.ec2.internal   Ready    master   82m   v1.22.1
ip-10-0-170-223.ec2.internal   Ready    master   82m   v1.22.1
ip-10-0-179-95.ec2.internal    Ready    worker   70m   v1.22.1
ip-10-0-182-134.ec2.internal   Ready    worker   70m   v1.22.1
ip-10-0-211-16.ec2.internal    Ready    master   82m   v1.22.1
ip-10-0-250-100.ec2.internal   Ready    worker   69m   v1.22.1
----
